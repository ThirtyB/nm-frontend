# 系统评分功能开发完成（已适配时间参数）

## 功能概述

已成功将后端的系统评分机制集成到前端，并适配了新的时间参数要求。主要实现了以下功能：

## 1. API接口集成

创建了 `src/utils/scoringApi.js` 文件，包含以下API接口：
- `getMachineScores(params)` - 获取所有机器评分
- `getMachineScore(ip, params)` - 获取特定机器评分  
- `getScoringSummary(params)` - 获取评分汇总统计

**重要更新**：所有API调用现在都需要必填的时间参数：
- `start_time`: 开始时间戳（Unix时间戳）
- `end_time`: 结束时间戳（Unix时间戳）
- `ips`: 可选的IP列表
- `include_details`: 是否包含详细扣分信息

## 2. 主页(Dashboard.vue)功能更新

### 移除内容
- 删除了原有的4个功能卡片（系统监控、数据分析、系统设置、告警管理）
- 保留了欢迎信息和告警信息模块

### 新增内容
- **系统评分概览卡片**：显示所有机器的评分汇总
- **维度评分展示**：显示CPU、内存、磁盘、网络、Swap五个维度的平均分
- **机器评分列表**：显示前8台机器的详细评分，包含各维度分数和告警数量
- **评分颜色编码**：
  - 绿色(≥80分)：优秀
  - 橙色(60-79分)：良好
  - 红色(40-59分)：较差
  - 灰色(<40分)：很差

### 交互功能
- 刷新评分按钮
- 查看全部评分弹窗
- 点击"查看详情"跳转到节点详情页

## 3. 节点详情页(NodeDetail.vue)功能更新

### 新增内容
- **系统评分卡片**：显示当前节点的详细评分
- **五维评分展示**：每个维度显示分数、进度条和告警数量
- **评估时间显示**：显示评分计算的时间

### 交互功能
- 刷新评分按钮
- 实时显示最新评分数据

## 4. 节点列表页(Nodes.vue)功能更新

### 新增内容
- **系统评分列**：在节点列表中显示每台机器的总评分
- **评分标签**：使用颜色编码显示评分等级

### 数据同步
- 获取节点数据时同时获取评分数据
- 建立IP到评分的映射关系

## 5. 评分规则说明

根据后端API文档，评分规则如下：

### 初始分数
- 每台机器初始100分

### 扣分规则
- info级别告警：扣5分
- warning级别告警：扣10分  
- error级别告警：扣20分
- critical级别告警：扣40分

### 维度划分
- **CPU**：cpu_usr, cpu_sys, cpu_iow, cpu_usage_rate, system_in, system_cs
- **内存**：mem_total, mem_free, mem_buff, mem_cache, memory_usage_rate
- **磁盘**：disk_total, disk_used, disk_used_percent, disk_iops, disk_r, disk_w
- **网络**：net_rx_kbps, net_tx_kbps, net_rx_kbytes, net_tx_kbytes, network_rate
- **Swap**：swap_total, swap_used, swap_in, swap_out, swap_usage_rate

### 总分计算
- 各维度分数的平均值

## 6. 技术实现细节

### 组件更新
- 使用Element Plus的进度条组件显示评分
- 使用标签组件显示评分等级
- 响应式设计，支持不同屏幕尺寸

### 数据处理
- 实时获取评分数据，不进行本地缓存
- 错误处理和用户友好的提示信息
- 数据加载状态显示

### 样式设计
- 统一的评分卡片样式
- 颜色编码系统，直观显示评分等级
- 悬停效果和过渡动画

## 7. 启动和测试

项目已成功启动在：http://localhost:3003/

### 测试步骤
1. 访问主页查看评分概览
2. 点击"查看详情"进入节点详情页查看详细评分
3. 访问节点列表页查看所有机器评分
4. 测试刷新功能
5. 验证评分颜色编码是否正确

## 8. 注意事项

- 评分数据实时计算，不存储在数据库中
- 基于最新的监控数据和告警规则进行评估
- 无告警的机器各维度均为100分，总分100分
- 需要后端服务正常运行才能获取评分数据

## 9. 时间参数适配说明

### 更新内容
- **API调用适配**：所有评分API调用现在都包含必填的时间参数
- **时间范围同步**：评分数据的时间范围与告警数据保持一致
- **自动获取机制**：评分数据会在相关数据获取完成后自动获取
- **错误处理**：增加了时间范围未设置时的友好提示

### 数据流程
1. 用户选择时间范围（默认最近24小时）
2. 获取告警/节点数据
3. 自动使用相同时间范围获取评分数据
4. 显示评分结果

### 时间范围来源
- **Dashboard页面**：使用告警时间选择器的时间范围
- **NodeDetail页面**：使用节点详情页的时间选择器的时间范围  
- **Nodes页面**：使用节点列表页的时间选择器的时间范围

## 10. 后续优化建议

- 考虑添加评分历史趋势图表
- 可以增加评分阈值设置功能
- 添加评分变化告警功能
- 考虑批量操作功能（如批量刷新评分）
- 添加评分数据缓存机制，避免重复请求
- 考虑添加评分时间范围独立选择功能